<?php/** * Created by PhpStorm. * User: zhao820019382 * Date: 16/5/30 * Time: 下午2:32 */namespace app\controller\backend;use core\Model;use app\model\userModel;use core\Controller;class userController extends Controller{    /**     *     */    public function add()    {       //$userModel = new userModel();       $userModel = userModel::create();        if(!empty($_POST)) {            $data = [                'username' => $_POST['username'],                'nickname' => $_POST['nickname'],                'email'    => $_POST['email'],                'password' => md5($_POST['password']),            ];           // var_dump($data);die;            if($userModel->add($data)) {                $this->redirect('index.php?p=backend&c=user&a=userList', 1, '插入成功。');            } else {                $this->redirect('index.php?p=backend&c=user&a=add', 1, '插入失败');            }        } else {            $this->loadHtml('user/useradd');        }    }    public function  delete()    {        $id = $_GET['id'];         $userModel = userModel::create();        if($userModel->deleteById($id)) {            $this->redirect('index.php?p=backend&a=userList&c=user', 1, '删除成功');        } else {            $this->redirect('index.php?p=backend&a=userList&c=user', 1, '删除失败');        }    }    public function update()    {        $id = $_GET['id'];        $userModel = userModel::create();        if(!empty($_POST)) {            $data = array(                'username' => $_POST['Username'],                'nickname' => $_POST['Nickname'],                'email'    => $_POST['Email']            );            if($userModel->updateById($id, $data)) {                $this->redirect('index.php?p=backend&c=user&a=userList', 1, '修改成功');            } else {                $this->redirect('index.php?p=backend&c=user&a=update&id=' . $id, 1, '修改失败');            }        } else {            $user = $userModel->findOneById($id);            $this->loadHtml('user/UserEdit', array('user' => $user,));        }    }    public function login()    {        if ($_POST) {            if($_POST['edtCaptcha'] != $_SESSION['captcha']) {                $this->redirect('index.php?p=backend&c=user&a=login', 1, '验证码错误');                die();            }            $username = addslashes($_POST['username']);            $userModel = userModel::create();            $user = $userModel->findOneBy("password='{$_POST['password']}' AND username='{$username}'");          //  var_dump($user);            if (!empty($user)) {//                echo 'ok';//                var_dump($user);die;                $_SESSION['loginFlag'] = true;                $_SESSION['user'] = $user;                $this->redirect('index.php?p=frontend&c=article&a=getlist', 1, '登录成功');            } else {                $_SESSION['loginFlag'] = false;                $this->redirect('index.php?a=login&c=user&p=backend', 1, '登录失败');            }        } else {            $this->loadHtml('user/login');        }    }    public function userList()    {       // $userModel = Model::create('app\model\userModel');        $userModel = userModel::create();        $users = $userModel->findAll();        $data = array(            'users' => $users,        );        $this->loadHtml('user/userList',$data);    }    public function logout()    {        $_SESSION['loginFlag'] = false;        $this->redirect('index.php?a=login&p=backend&c=user');    }    public function captcha()    {        $c = new \vendor\Captcha();        $c->generateCode();        $_SESSION['captcha'] =  $c->getCode();    }}